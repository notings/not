"use strict";!function(){var s=document.getElementsByClassName("main-count")[0];console.log(s);document.getElementsByClassName("list")[0],document.getElementsByClassName("text")[0];var N=getCookie("username");function E(){ajax({type:"get",url:"../api/goodsCar.php",data:{username:N},success:function(e){!function(e){if("您的购物车空空如也"!=e){var t=JSON.parse(e);console.log(t);var n=t.map(function(e){return'<div class="list" data-id="'+e.id+'"> \n                                <div class="list-checkbox">\n                                    <input type="checkbox" class="checkbox">\n                                </div>\n                                <div class="img-count">\n                                    <div class="dimg"><img src="'+e.imgurl+'" alt=""></div>\n                                    <div class="counts"><a href="###">'+e.title+'</a></div>\n                                </div>\n                                <div class="list-condition">'+e.newj+'</div>\n                                <div class="list-unit">'+e.price+'</div>\n                                <div class="list-input">\n                                    <div class="text-box">\n                                        <input type="button" value="-" class="cut telx">\n                                        <input type="text" class="text text-cont" id="text-cont" data-kucun="'+e.counts+'" value="'+e.counts+'">\n                                        <input type="button" value="+" class="add telx">\n                                    </div>\n                                    <div class="text-inf">\n                                    <span class="text-inf1">至少购买一件商品！</span>\n                                    <span class="text-inf2">仅1件在售!</span>\n                                    </div>\n                                </div>\n                                <div class="list-price money">'+(e.price*e.counts).toFixed(2)+'</div>\n                                <div class="list-operate">\n                                    <span class="collect">移入收藏</span>\n                                    <span class="delete">删除</span>\n                                </div>\n                            </div> '}).join("");s.innerHTML=n,function(){var t=document.getElementsByClassName("cut"),s=document.getElementsByClassName("text-cont"),n=document.getElementsByClassName("add"),i=document.getElementsByClassName("list-unit"),c=document.getElementsByClassName("list-price"),a=document.getElementsByClassName("delete"),o=document.getElementsByClassName("list"),l=document.getElementsByClassName("checkbox"),d=(document.querySelector(".text-inf"),document.querySelector(".text-inf1")),u=document.querySelector(".text-inf2"),r=document.getElementById("checkboxst"),m=document.getElementById("total-price"),p=document.getElementById("selected-items"),v=document.getElementById("account-right"),e=document.getElementById("del");f();var g=void 0;function h(e,t){var n=s[t].dataset.kucun;console.log(s[t]),e<1&&(e=1,d.style.display="block"),n<=e&&(e=n,u.style.display="block"),function(e,t,n){ajax({type:"post",url:"../api/goodsCarCount.php",data:{username:e,gid:t,counts:n},success:function(e){console.log(e)}})}(getCookie("username"),g,e),s[t].value=e,c[t].innerHTML=(i[t].innerHTML*e).toFixed(2),k()}function f(){for(var e=0;e<o.length;e++)t[e].index=e,n[e].index=e,l[e].index=e,a[e].index=e,s[e].index=e}for(var x=0;x<t.length;x++)f(),t[x].onclick=function(){var e=1*s[this.index].value;h(--e,this.index),g=this.parentNode.parentNode.dataset.id},n[x].onclick=function(){var e=1*s[this.index].value;h(++e,this.index),g=this.parentNode.parentNode.dataset.id},a[x].onclick=function(){confirm("确定要删除该商品吗？");g=this.parentNode.parentNode.dataset.id,ajax({type:"post",url:"../api/deleteGoods.php",data:{type:"delgoods",username:N,gid:g},success:function(e){console.log(e),history.go(0)}})},l[x].onclick=function(){k(),this.checked?o[this.index].style.background="cornflowerblue":o[this.index].style.background=""},s[x].oninput=function(){var e=1*s[this.index].value;if(isNaN(e))alert("请输入正确的数字");else{h(e,this.index);e=1*s[this.index].value;g=this.parentNode.parentNode.dataset.id}};function y(){for(var e=0,t=[],n=0;n<l.length;n++)l[n].checked&&(e++,t.push(n));return e==l.length?r.checked=!0:r.checked=!1,t}function k(e){e=y();var t=0,n=0;e.forEach(function(e){t+=1*s[e].value,n+=1*c[e].innerHTML}),p.innerHTML=t,m.innerHTML=n.toFixed(2),e.length?v.className="account-right dian":v.className="account-right dian no"}r.onclick=function(){for(var e=0;e<l.length;e++)l[e].checked=r.checked,l[e].checked?o[e].style.background="cornflowerblue":o[e].style.background="";k()},e.onclick=function(){var e=y().reverse();confirm("确定要删除选中的商品吗？")&&(e.forEach(function(e){E(),ajax({type:"post",url:"../api/deleteGoods.php",data:{type:"delallgoods",username:N,gid:g},success:function(e){window.location.reload()}})}),k(),f())}}()}}(e)}})}E()}();